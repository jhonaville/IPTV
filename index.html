<script>
const video = document.getElementById("video");
const result = document.getElementById("result");

async function iniciar() {

  if (!("BarcodeDetector" in window)) {
    result.textContent = "Tu navegador no soporta BarcodeDetector";
    return;
  }

  const stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: "environment" }
  });

  video.srcObject = stream;
  await video.play();

  const detector = new BarcodeDetector({
    formats: ["ean_13", "ean_8", "code_128"]
  });

  async function detectar() {
    try {
      const barcodes = await detector.detect(video);

      if (barcodes.length > 0) {
        result.textContent = "Resultado: " + barcodes[0].rawValue;
        navigator.vibrate(200);
      }

    } catch (err) {
      console.error(err);
    }

    requestAnimationFrame(detectar);
  }

  detectar();
}

iniciar();
</script>
